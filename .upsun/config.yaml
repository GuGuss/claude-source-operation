applications:
  app:
    type: php:8.5
    dependencies:
      nodejs:
        anthropic-ai/claude-code: '*'
    hooks:
      build: |
        set -ex
        # Install claude-code package dependencies if needed
        # (Assuming claude-code is a CLI tool installed via Nix package)
        claude-code --version
    web:
      locations:
        '/':
          root: 'public'
          passthru: '/app.php'
    source:
      operations:
        source-code-operator:
          command:
            set -ex
            # Run claude-code with the prompt
            RESULT=$(claude-code "$1")
            # Commit the result to the current git branch
            git add .
            git commit -m "Update from claude-code: $RESULT"

routes:
  'https://{default}':
    type: upstream
    upstream: app:http
