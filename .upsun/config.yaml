applications:
  app:
    type: php:8.4
    dependencies:
      nodejs:
        '@anthropic-ai/claude-code': '*'
    hooks:
      build: |
        set -ex
        # Install claude-code package dependencies if needed
        # (Assuming claude-code is a CLI tool installed via Nix package)
        claude --version
    web:
      locations:
        '/':
          root: 'public'
          passthru: '/app.php'
    source:
      operations:
        source-code-operator:
          command: |
            set -ex
            
            # bypass claude-code permissions prompt
            mkdir -p .claude
            echo '{"permissions": {"defaultMode": "bypassPermissions"}}' > .claude/settings.json
            
            # Run claude-code with the prompt
            RESULT=$(claude "${INPUT}. Once done, commit the changes with a nice message.")            
routes:
  'https://{default}':
    type: upstream
    upstream: app:http
